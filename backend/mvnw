#!/bin/sh
# Maven Wrapper (somente script - baixa Maven e executa, sem JAR do wrapper)
MAVEN_PROJECTBASEDIR="$(cd "$(dirname "$0")" && pwd)"
MAVEN_VERSION="3.9.6"
DISTRO_URL="https://repo1.maven.org/maven2/org/apache/maven/apache-maven/${MAVEN_VERSION}/apache-maven-${MAVEN_VERSION}-bin.zip"
WRAPPER_DIR="$MAVEN_PROJECTBASEDIR/.mvn/wrapper"
MAVEN_DIR="$WRAPPER_DIR/apache-maven-$MAVEN_VERSION"
MAVEN_ZIP="$WRAPPER_DIR/apache-maven-$MAVEN_VERSION-bin.zip"
MVN_CMD="$MAVEN_DIR/bin/mvn"

if [ ! -x "$MVN_CMD" ]; then
  echo "Maven $MAVEN_VERSION not found. Downloading..."
  mkdir -p "$WRAPPER_DIR"
  if command -v curl >/dev/null 2>&1; then
    curl -sL -o "$MAVEN_ZIP" "$DISTRO_URL" || exit 1
  else
    wget -q -O "$MAVEN_ZIP" "$DISTRO_URL" || exit 1
  fi
  (cd "$WRAPPER_DIR" && jar xf "$MAVEN_ZIP") || exit 1
  rm -f "$MAVEN_ZIP"
  if [ ! -x "$MVN_CMD" ]; then
    echo "Failed to extract Maven."
    exit 1
  fi
  echo "Maven $MAVEN_VERSION ready."
fi

cd "$MAVEN_PROJECTBASEDIR"
exec "$MVN_CMD" "$@"
